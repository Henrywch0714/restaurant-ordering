// Language translations
const translations = {
    en: {
        // Header
        title: "ðŸ½ï¸ Delicious Bites Restaurant",
        tagline: "Order your favorite meals online",
        specialNeeds: "Do you have any special dietary needs or allergies?",
        specialNeedsBtn: "Yes, I have special needs",
        
        // Menu
        menuTitle: "Our Menu",
        categoryAll: "All",
        categoryAppetizers: "Appetizers",
        categoryMains: "Main Courses",
        categoryDesserts: "Desserts",
        categoryDrinks: "Drinks",
        addToCart: "Add to Cart",
        recommended: "âœ“ Recommended for you",
        
        // Cart
        cartTitle: "Your Order",
        emptyCart: "Your cart is empty",
        total: "Total",
        checkout: "Checkout",
        
        // Chatbot
        chatbotTitle: "ðŸ¤– Dietary Assistant",
        chatbotPlaceholder: "Type your dietary needs here...",
        chatbotSend: "Send",
        chatbotApply: "Apply Recommendations",
        chatbotClear: "Clear Chat",
        chatbotWelcome: "Hello! I'm here to help you find meals that suit your dietary needs and feelings. Please tell me about any allergies, health conditions, dietary preferences, or how you're feeling. For example: \"I'm upset\" or \"I have diabetes and a peanut allergy\" or \"I'm vegetarian and have a sore throat.\"",
        
        // Checkout
        checkoutTitle: "Order Confirmation",
        confirmOrder: "Confirm Order",
        
        // Language
        language: "Language",
        langEn: "English",
        langZh: "ç¹é«”ä¸­æ–‡",
        langZhCN: "ç®€ä½“ä¸­æ–‡"
    },
    zh: { // Cantonese (Traditional Chinese)
        // Header
        title: "ðŸ½ï¸ Delicious Bites Restaurant",
        tagline: "Order your favorite meals online",
        specialNeeds: "Do you have any special dietary needs or allergies?",
        specialNeedsBtn: "Yes, I have special needs",
        
        // Menu
        menuTitle: "Our Menu",
        categoryAll: "All",
        categoryAppetizers: "Appetizers",
        categoryMains: "Main Courses",
        categoryDesserts: "Desserts",
        categoryDrinks: "Drinks",
        addToCart: "Add to Cart",
        recommended: "âœ“ Recommended for you",
        
        // Cart
        cartTitle: "Your Order",
        emptyCart: "Your cart is empty",
        total: "Total",
        checkout: "Checkout",
        
        // Chatbot
        chatbotTitle: "ðŸ¤– Dietary Assistant",
        chatbotPlaceholder: "Type your dietary needs here...",
        chatbotSend: "Send",
        chatbotApply: "Apply Recommendations",
        chatbotClear: "Clear Chat",
        chatbotWelcome: "Hello! I'm here to help you find meals that suit your dietary needs and feelings. Please tell me about any allergies, health conditions, dietary preferences, or how you're feeling. For example: \"I'm upset\" or \"I have diabetes and a peanut allergy\" or \"I'm vegetarian and have a sore throat.\"",
        
        // Checkout
        checkoutTitle: "Order Confirmation",
        confirmOrder: "Confirm Order",
        
        // Language
        language: "Language",
        langEn: "English",
        langZh: "ç¹é«”ä¸­æ–‡"
    },
    zh: {
        // Header
        title: "ðŸ½ï¸ ç¾Žå‘³é¤å»³",
        tagline: "åœ¨ç·šè¨‚è³¼æ‚¨å–œæ„›çš„ç¾Žé£Ÿ",
        specialNeeds: "æ‚¨æ˜¯å¦æœ‰ä»»ä½•ç‰¹æ®Šé£²é£Ÿéœ€æ±‚æˆ–éŽæ•ï¼Ÿ",
        specialNeedsBtn: "æ˜¯çš„ï¼Œæˆ‘æœ‰ç‰¹æ®Šéœ€æ±‚",
        
        // Menu
        menuTitle: "æˆ‘å€‘çš„èœå–®",
        categoryAll: "å…¨éƒ¨",
        categoryAppetizers: "é–‹èƒƒèœ",
        categoryMains: "ä¸»èœ",
        categoryDesserts: "ç”œå“",
        categoryDrinks: "é£²å“",
        addToCart: "åŠ å…¥è³¼ç‰©è»Š",
        recommended: "âœ“ ç‚ºæ‚¨æŽ¨è–¦",
        
        // Cart
        cartTitle: "æ‚¨çš„è¨‚å–®",
        emptyCart: "æ‚¨çš„è³¼ç‰©è»Šæ˜¯ç©ºçš„",
        total: "ç¸½è¨ˆ",
        checkout: "çµå¸³",
        
        // Chatbot
        chatbotTitle: "ðŸ¤– é£²é£ŸåŠ©æ‰‹",
        chatbotPlaceholder: "è«‹è¼¸å…¥æ‚¨çš„é£²é£Ÿéœ€æ±‚...",
        chatbotSend: "ç™¼é€",
        chatbotApply: "æ‡‰ç”¨æŽ¨è–¦",
        chatbotClear: "æ¸…é™¤å°è©±",
        chatbotWelcome: "æ‚¨å¥½ï¼æˆ‘æ˜¯ä¾†å¹«åŠ©æ‚¨æ‰¾åˆ°é©åˆæ‚¨é£²é£Ÿéœ€æ±‚å’Œæ„Ÿå—çš„é¤é»žã€‚è«‹å‘Šè¨´æˆ‘ä»»ä½•éŽæ•ã€å¥åº·ç‹€æ³ã€é£²é£Ÿåå¥½æˆ–æ‚¨çš„æ„Ÿå—ã€‚ä¾‹å¦‚ï¼šã€Œæˆ‘å¾ˆæ²®å–ªã€æˆ–ã€Œæˆ‘æœ‰ç³–å°¿ç—…å’ŒèŠ±ç”ŸéŽæ•ã€æˆ–ã€Œæˆ‘æ˜¯ç´ é£Ÿä¸»ç¾©è€…ï¼Œè€Œä¸”å–‰åš¨ç—›ã€‚ã€",
        chatbotApplyReady: "å¤ªå¥½äº†ï¼æŽ¨è–¦å·²æº–å‚™å¥½ã€‚é»žæ“Šã€Œæ‡‰ç”¨æŽ¨è–¦ã€å³å¯æŸ¥çœ‹ã€‚",
        
        // Checkout
        checkoutTitle: "è¨‚å–®ç¢ºèª",
        confirmOrder: "ç¢ºèªè¨‚å–®",
        
        // Language
        language: "èªžè¨€",
        langEn: "English",
        langZh: "ç¹é«”ä¸­æ–‡",
        langZhCN: "ç®€ä½“ä¸­æ–‡"
    },
    zhCN: { // Mandarin (Simplified Chinese)
        // Header
        title: "ðŸ½ï¸ ç¾Žå‘³é¤åŽ…",
        tagline: "åœ¨çº¿è®¢è´­æ‚¨å–œçˆ±çš„ç¾Žé£Ÿ",
        specialNeeds: "æ‚¨æ˜¯å¦æœ‰ä»»ä½•ç‰¹æ®Šé¥®é£Ÿéœ€æ±‚æˆ–è¿‡æ•ï¼Ÿ",
        specialNeedsBtn: "æ˜¯çš„ï¼Œæˆ‘æœ‰ç‰¹æ®Šéœ€æ±‚",
        
        // Menu
        menuTitle: "æˆ‘ä»¬çš„èœå•",
        categoryAll: "å…¨éƒ¨",
        categoryAppetizers: "å¼€èƒƒèœ",
        categoryMains: "ä¸»èœ",
        categoryDesserts: "ç”œå“",
        categoryDrinks: "é¥®å“",
        addToCart: "åŠ å…¥è´­ç‰©è½¦",
        recommended: "âœ“ ä¸ºæ‚¨æŽ¨è",
        
        // Cart
        cartTitle: "æ‚¨çš„è®¢å•",
        emptyCart: "æ‚¨çš„è´­ç‰©è½¦æ˜¯ç©ºçš„",
        total: "æ€»è®¡",
        checkout: "ç»“è´¦",
        
        // Chatbot
        chatbotTitle: "ðŸ¤– é¥®é£ŸåŠ©æ‰‹",
        chatbotPlaceholder: "è¯·è¾“å…¥æ‚¨çš„é¥®é£Ÿéœ€æ±‚...",
        chatbotSend: "å‘é€",
        chatbotApply: "åº”ç”¨æŽ¨è",
        chatbotClear: "æ¸…é™¤å¯¹è¯",
        chatbotWelcome: "æ‚¨å¥½ï¼æˆ‘æ˜¯æ¥å¸®åŠ©æ‚¨æ‰¾åˆ°é€‚åˆæ‚¨é¥®é£Ÿéœ€æ±‚å’Œæ„Ÿå—çš„é¤ç‚¹ã€‚è¯·å‘Šè¯‰æˆ‘ä»»ä½•è¿‡æ•ã€å¥åº·çŠ¶å†µã€é¥®é£Ÿåå¥½æˆ–æ‚¨çš„æ„Ÿå—ã€‚ä¾‹å¦‚ï¼šã€Œæˆ‘å¾ˆæ²®ä¸§ã€æˆ–ã€Œæˆ‘æœ‰ç³–å°¿ç—…å’ŒèŠ±ç”Ÿè¿‡æ•ã€æˆ–ã€Œæˆ‘æ˜¯ç´ é£Ÿä¸»ä¹‰è€…ï¼Œè€Œä¸”å–‰å’™ç—›ã€‚ã€",
        
        // Checkout
        checkoutTitle: "è®¢å•ç¡®è®¤",
        confirmOrder: "ç¡®è®¤è®¢å•",
        
        // Language
        language: "è¯­è¨€",
        langEn: "English",
        langZh: "ç¹é«”ä¸­æ–‡",
        langZhCN: "ç®€ä½“ä¸­æ–‡"
    }
};

// Current language (default: English)
// Language codes: 'en' = English, 'zh' = Cantonese (Traditional), 'zhCN' = Mandarin (Simplified)
let currentLanguage = localStorage.getItem('language') || 'en';

// Get translation
function t(key) {
    return translations[currentLanguage][key] || key;
}

// Switch language
function switchLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('language', lang);
    updatePageLanguage();
    updateChatbotLanguage();
    updateVoiceRecognitionLanguage();
    updateLanguageSwitcher();
}

// Update language switcher active state
function updateLanguageSwitcher() {
    const langEn = document.getElementById('langEn');
    const langZh = document.getElementById('langZh');
    const langZhCN = document.getElementById('langZhCN');
    
    // Remove active class from all
    [langEn, langZh, langZhCN].forEach(btn => {
        if (btn) btn.classList.remove('active');
    });
    
    // Add active class to current language
    if (currentLanguage === 'en' && langEn) {
        langEn.classList.add('active');
    } else if (currentLanguage === 'zh' && langZh) {
        langZh.classList.add('active');
    } else if (currentLanguage === 'zhCN' && langZhCN) {
        langZhCN.classList.add('active');
    }
}

// Update page language
function updatePageLanguage() {
    // Update header
    const title = document.querySelector('header h1');
    if (title) title.textContent = t('title');
    
    const tagline = document.querySelector('.tagline');
    if (tagline) tagline.textContent = t('tagline');
    
    const specialNeedsText = document.querySelector('.special-needs-selector span');
    if (specialNeedsText) specialNeedsText.textContent = t('specialNeeds');
    
    const specialNeedsBtn = document.getElementById('specialNeedsBtn');
    if (specialNeedsBtn) specialNeedsBtn.textContent = t('specialNeedsBtn');
    
    // Update menu
    const menuTitle = document.querySelector('.menu-section h2');
    if (menuTitle) menuTitle.textContent = t('menuTitle');
    
    // Update category tabs
    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach(tab => {
        const category = tab.getAttribute('data-category');
        if (category === 'all') tab.textContent = t('categoryAll');
        else if (category === 'appetizers') tab.textContent = t('categoryAppetizers');
        else if (category === 'mains') tab.textContent = t('categoryMains');
        else if (category === 'desserts') tab.textContent = t('categoryDesserts');
        else if (category === 'drinks') tab.textContent = t('categoryDrinks');
    });
    
    // Update cart
    const cartTitle = document.querySelector('.cart-header h2');
    if (cartTitle) cartTitle.textContent = t('cartTitle');
    
    const emptyCart = document.querySelector('.empty-cart');
    if (emptyCart) emptyCart.textContent = t('emptyCart');
    
    const totalLabel = document.querySelector('.cart-total span');
    if (totalLabel) {
        const total = document.getElementById('cartTotal').textContent;
        totalLabel.innerHTML = `${t('total')}: $<span id="cartTotal">${total}</span>`;
    }
    
    const checkoutBtn = document.getElementById('checkoutBtn');
    if (checkoutBtn) checkoutBtn.textContent = t('checkout');
    
    // Update checkout modal
    const checkoutModalTitle = document.querySelector('#checkoutModal h2');
    if (checkoutModalTitle) checkoutModalTitle.textContent = t('checkoutTitle');
    
    const confirmOrderBtn = document.getElementById('confirmOrder');
    if (confirmOrderBtn) confirmOrderBtn.textContent = t('confirmOrder');
    
    // Re-render menu to update button texts
    if (typeof renderMenu === 'function') {
        renderMenu();
    }
    
    // Update cart display
    if (typeof updateCartDisplay === 'function') {
        updateCartDisplay();
    }
}

// Update chatbot language
function updateChatbotLanguage() {
    const chatbotTitle = document.querySelector('.chatbot-header h2');
    if (chatbotTitle) chatbotTitle.textContent = t('chatbotTitle');
    
    const chatbotInput = document.getElementById('chatbotInput');
    if (chatbotInput) chatbotInput.placeholder = t('chatbotPlaceholder');
    
    const sendBtn = document.getElementById('sendMessageBtn');
    if (sendBtn) sendBtn.textContent = t('chatbotSend');
    
    const applyBtn = document.getElementById('applyRecommendationsBtn');
    if (applyBtn) applyBtn.textContent = t('chatbotApply');
    
    const clearBtn = document.getElementById('clearChatBtn');
    if (clearBtn) clearBtn.textContent = t('chatbotClear');
    
    // Update welcome message if chat is empty
    const messagesContainer = document.getElementById('chatbotMessages');
    if (messagesContainer && messagesContainer.children.length === 1) {
        const welcomeMsg = messagesContainer.querySelector('.bot-message p');
        if (welcomeMsg) welcomeMsg.textContent = t('chatbotWelcome');
    }
}

// Update voice recognition language
function updateVoiceRecognitionLanguage() {
    if (typeof recognition !== 'undefined' && recognition !== null) {
        // Set language based on current language
        // 'en' = English (en-US), 'zh' = Cantonese (zh-HK), 'zhCN' = Mandarin (zh-CN)
        if (currentLanguage === 'zh') {
            recognition.lang = 'zh-HK'; // Cantonese (Hong Kong)
        } else if (currentLanguage === 'zhCN') {
            recognition.lang = 'zh-CN'; // Mandarin (Simplified Chinese)
        } else {
            recognition.lang = 'en-US'; // English
        }
        console.log('Voice recognition language set to:', recognition.lang);
    }
}

// Initialize language on page load
document.addEventListener('DOMContentLoaded', () => {
    updatePageLanguage();
    updateChatbotLanguage();
    updateVoiceRecognitionLanguage();
    updateLanguageSwitcher();
});

// Export for global access
window.translations = translations;
window.t = t;
window.switchLanguage = switchLanguage;
window.currentLanguage = currentLanguage;

